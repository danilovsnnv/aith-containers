# <center> Лабораторная работа 1. Dockerfile.</center>

## Сервис для суммаризации сайта компании
В качестве приложения для работы используется сервис для суммаризации веб сайтов.

По URL суммаризирует сайт, выявляет:

* Название компании
* Описание компании
* Ценность товара (5 пунктов)
* Болевые точки (5 пунктов)

Используется как микросервис в проекте

## Запуск

Пример для хорошего dockerfile

```bash
docker build -t docker_good -f Dockerfile_good .
docker run -p 8080:8080 --name docker_good --env-file .env docker_good
```

Результат запуска

![result](/images/swagger.png)

## Плохие и хорошие практики Dockerfile

Примеры в файлах Dockerfile_bad и Dockerfile_good соответственно

1. Использование не фиксированной версии (`python:latest`)

Использование `latest` вместо фиксированной версии образа может привести к нестабильности, так как версия может измениться 
в будущем, что может повлиять на сборку и работу приложения. В хорошем Dockerfile используется конкретная версия 
(`python:3.11-slim`), что обеспечивает предсказуемость и стабильность сборок.

2. Неоптимальное копирование (`COPY . /workdir`)

Копирование всех файлов в директорию /workdir может привести к добавлению ненужных файлов в образ (например, .git, 
временные файлы), что увеличивает размер образа и может раскрывать конфиденциальные данные. В хорошем Dockerfile явно 
копируются только нужные файлы (requirements.txt, app/, model/), уменьшая объем данный в контейнере.

3. Неоптимальная установка зависимостей (`RUN pip install --upgrade pip и RUN pip install -r requirements.txt`)

Отсутствие флага `--no-cache-dir` приводит к сохранению кэша pip, что увеличивает размер образа. Также команды RUN 
раздельно создают лишние слои, что может привести к избыточному использованию ресурсов и усложнению образа.
В хорошем Dockerfile команды установки зависимостей объединены и используется --no-cache-dir для предотвращения сохранения кэша

4. Не указана точка монтирования для VOLUME

Указание `VOLUME ./logs` без четкого пути может привести к неопределенному поведению или неочевидным результатам 
при работе с данными внутри контейнера. В хорошем Dockerfile указана конкретная точка монтирования: `VOLUME ["/workdir/logs"]`

5. Хардкод порта (EXPOSE 8080)

Хардкод значений затрудняет настройку и развертывание, например, если нужно динамически менять порт. В исправленном 
Dockerfile используется переменная окружения `$PORT`

## Плохие практики использования контейнера

1. Запуск нескольких процессов в одном контейнере

Контейнер должен выполнять одну функцию. Для нескольких разных процессов лучше использовать несколько контейнеров

2. Ввод конфиденциальной информации (пароли, токены) через команду `ENV`

Данные остаются в Dockerfile и каждый может прочитать их. Лучше использовать `.env` файлы

3. Хранение информации в контейнерах

Контейнеры должны быть stateless, в них не может хранится какая-то информация. Для сохранения информации следует
использовать `VOLUME`

## Случаи когда не применяются контейнеры в целом

1. Одноразовые скрипты

Это могут быть скрипты или задачи, которые выполняются один раз или не требуют сложного развертывания. Например, скрипты 
для анализа данных. Использование контейнеров для запуска небольших скриптов, которые выполняются один раз, бессмысленно 
и усложняет работу.
 
2. Монолитные приложения

Если приложение монолитное и не требует декомпозиции на микросервисы, то использование контейнера контейнеров может 
привести к избыточной сложности без значительных преимуществ, таких как гибкость и модульность, которые контейнеры 
предоставляют микросервисам.

3. Приложения с высокими требования к безопасности

Если приложению требуется высокий уровень безопасности и изоляции, контейнеры могут не предоставить достаточную защиту. 
Для приложений с повышенными требованиями к безопасности, виртуальные машины могут быть
более предпочтительным вариантом.